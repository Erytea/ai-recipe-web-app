"""
Скрипт для импорта продуктов из скопированных данных calorizator.ru
"""

import re


def parse_calorizator_data(text: str, category: str = "food") -> dict:
    """Парсит данные, скопированные с calorizator.ru"""
    
    products = {}
    lines = text.strip().split('\n')
    
    for line in lines:
        # Пропускаем заголовки и пустые строки
        if not line.strip() or 'Продукт' in line or 'Бел, г' in line:
            continue
        
        # Разбиваем по табуляции
        parts = line.split('\t')
        
        # Пытаемся найти числа в конце строки
        numbers = []
        name_parts = []
        
        for part in parts:
            part = part.strip()
            if not part:
                continue
            
            # Пытаемся распарсить как число
            try:
                num = float(part.replace(',', '.'))
                numbers.append(num)
            except ValueError:
                # Это часть названия
                if len(numbers) == 0:  # Числа еще не начались
                    name_parts.append(part)
        
        # Должно быть ровно 4 числа: белки, жиры, углеводы, калории
        if len(numbers) == 4 and len(name_parts) > 0:
            # Берем последнюю часть названия как основное имя (обычно дубликат)
            name = name_parts[-1] if len(name_parts) > 1 else name_parts[0]
            name = name.lower().strip()
            
            protein, fat, carbs, calories = numbers
            
            products[name] = {
                "calories": calories,
                "protein": protein,
                "fat": fat,
                "carbs": carbs,
                "category": category
            }
    
    return products


# Данные колбасных изделий
sausage_data = """
Колбаса вареная Диетическая	Колбаса вареная Диетическая	12.1	13.5	0.0	170
Колбаса вареная Докторская	Колбаса вареная Докторская	12.8	22.2	1.5	257
Колбаса вареная Куриная	Колбаса вареная Куриная	15.5	16.2	2.3	223
Колбаса вареная Любительская	Колбаса вареная Любительская	12.2	28.0	0.1	301
Колбаса вареная Молочная	Колбаса вареная Молочная	11.7	22.8	0.2	252
Колбаса вареная Московская	Колбаса вареная Московская	11.5	21.8	2.0	250
Колбаса вареная Русская	Колбаса вареная Русская	11.8	28.9	0.0	302
Колбаса вареная Свиная	Колбаса вареная Свиная	10.8	25.8	0.5	277
Колбаса вареная Столичная	Колбаса вареная Столичная	15.1	28.7	0.0	319
Колбаса варено-копченая Любительская	Колбаса варено-копченая Любительская	17.2	39.0	0.2	420
Колбаса варено-копченая Московская	Колбаса варено-копченая Московская	19.1	36.6	0.2	406
Колбаса варено-копченая сервелат	Колбаса варено-копченая сервелат	16.1	40.1	0.0	425
Колбаса ливерная	Колбаса ливерная	14.4	28.5	2.2	326
Колбаса печеночная домашняя	Колбаса печеночная домашняя	15.0	22.0	0.0	258
Колбаса полукопченая Закусочная	Колбаса полукопченая Закусочная	15.0	33.0	2.3	366
Колбаса полукопченая Краковская	Колбаса полукопченая Краковская	16.2	44.6	0.0	466
Колбаса полукопченая Минская	Колбаса полукопченая Минская	17.4	23.0	2.7	287
Колбаса полукопченая Одесская	Колбаса полукопченая Одесская	14.8	38.1	0.3	402
Колбаса полукопченая Полтавская	Колбаса полукопченая Полтавская	16.4	39.0	0.0	417
Колбаса полукопченая Таллиннская	Колбаса полукопченая Таллиннская	17.1	33.8	0.2	373
Колбаса полукопченая Украинская	Колбаса полукопченая Украинская	16.5	34.4	0.0	376
Колбаса сыровяленая Суджук	Колбаса сыровяленая Суджук	30.3	37.9	0.0	463
Колбаса сыровяленая Чоризо	Колбаса сыровяленая Чоризо	24.1	38.3	1.9	455
Колбаса сырокопченая брауншвейгская	Колбаса сырокопченая брауншвейгская	27.7	42.2	0.2	491
Колбаса сырокопченая зернистая	Колбаса сырокопченая зернистая	9.9	62.8	0.3	606
Колбаса сырокопченая любительская	Колбаса сырокопченая любительская	20.9	47.8	0.0	514
Колбаса сырокопченая московская	Колбаса сырокопченая московская	24.8	41.5	0.0	473
Колбаса сырокопченая сервелат	Колбаса сырокопченая сервелат	24.0	40.5	0.0	461
Колбаса сырокопченая столичная	Колбаса сырокопченая столичная	24.0	43.4	0.0	487
Салями	Салями	21.6	53.7	1.4	568
Сардельки говяжьи	Сардельки говяжьи	11.4	18.2	1.5	215
Сардельки свиные	Сардельки свиные	10.1	31.6	1.9	332
Сосиски говяжьи	Сосиски говяжьи	10.4	20.1	0.8	226
Сосиски куриные	Сосиски куриные	10.8	22.4	4.2	259
Сосиски любительские	Сосиски любительские	9.0	29.5	0.7	304
Сосиски молочные	Сосиски молочные	11.0	23.9	1.6	266
Сосиски особые	Сосиски особые	11.8	24.7	0.0	270
Сосиски русские	Сосиски русские	11.3	22.0	0.0	243
Сосиски свиные	Сосиски свиные	9.5	34.3	0.0	342
Шпикачки	Шпикачки	10.0	33.0	0.0	337
"""

if __name__ == "__main__":
    print("="*60)
    print("ПАРСИНГ КОЛБАСНЫХ ИЗДЕЛИЙ")
    print("="*60)
    products = parse_calorizator_data(sausage_data, "sausages")
    
    print(f"\n✅ Распарсено {len(products)} продуктов\n")
    print("Пример данных:")
    for i, (name, data) in enumerate(list(products.items())[:5]):
        print(f"  {name}: {data['calories']} ккал, Б:{data['protein']}г, Ж:{data['fat']}г, У:{data['carbs']}г")
    
    print("\n" + "="*60)
    print("Код для добавления в nutrition_database.py:")
    print("="*60 + "\n")
    
    for name, data in sorted(products.items()):
        print(f'        "{name}": {{"calories": {data["calories"]}, "protein": {data["protein"]}, "fat": {data["fat"]}, "carbs": {data["carbs"]}, "category": "sausages"}},')




