{% extends "layout.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- 1. Navigation - Back button -->
            <div class="mb-4">
                <a href="/recipes" class="back-link text-secondary text-decoration-none body-medium transition-fast" style="display: inline-flex; align-items: center; gap: var(--space-2);">
                    <span>←</span>
                    <span>Назад</span>
                </a>
            </div>

            <!-- 2. Hero-блок с фото -->
            {% if recipe.photo_file_id %}
            <div class="mb-6">
                <img src="/static/{{ recipe.photo_file_id }}" 
                     alt="{{ recipe_data.recipe_title }}"
                     class="img-fluid rounded-lg w-100"
                     style="aspect-ratio: 4/3; object-fit: cover;">
            </div>
            {% endif %}

            <!-- 3. Название блюда -->
            <h1 class="display-large mb-3" style="font-weight: var(--font-weight-semibold); color: var(--text-primary); line-height: var(--line-height-tight);">
                {{ recipe_data.recipe_title }}
            </h1>

            <!-- 4. Короткий подзаголовок (опционально) -->
            {% if recipe_data.get('subtitle') %}
            <p class="body-large mb-5 text-secondary" style="font-style: italic;">
                {{ recipe_data.subtitle }}
            </p>
            {% endif %}

            <!-- 5. Блок "Почему это хороший рецепт" -->
            {% if recipe_data.get('why_good') %}
            <div class="mb-6" style="padding-top: var(--space-6);">
                <p class="body-large" style="color: var(--text-primary); max-width: 100%;">
                    {{ recipe_data.why_good }}
                </p>
            </div>
            {% endif %}

            <!-- 6. Ингредиенты -->
            {% if recipe_data.ingredients_with_weights or recipe_data.ingredients %}
            <div class="mb-6">
                <h3 class="headline-medium mb-4" style="color: var(--text-primary); font-weight: var(--font-weight-semibold);">
                    Ингредиенты
                </h3>
                <div class="ingredients-list">
                    {% set ingredients_list = recipe_data.ingredients_with_weights or recipe_data.ingredients %}
                    {% for ingredient in ingredients_list %}
                    <div class="d-flex justify-content-between align-items-start mb-3" style="padding-bottom: var(--space-2);">
                        <span class="body-large" style="color: var(--text-primary); flex: 1;">
                            {% if 'name' in ingredient %}
                                {{ ingredient.name }}
                            {% else %}
                                {{ ingredient }}
                            {% endif %}
                        </span>
                        <span class="body-large text-secondary" style="margin-left: var(--space-4); white-space: nowrap;">
                            {% if 'weight_g' in ingredient and ingredient.weight_g %}
                                {{ ingredient.weight_g }}г
                            {% endif %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- 7. Как готовить -->
            {% if recipe_data.cooking_steps %}
            <div class="mb-6" style="padding-top: var(--space-6);">
                <h3 class="headline-medium mb-4" style="color: var(--text-primary); font-weight: var(--font-weight-semibold);">
                    Как готовить
                </h3>
                <ol class="cooking-steps" style="padding-left: var(--space-6); margin: 0;">
                    {% for step in recipe_data.cooking_steps %}
                    <li class="body-large mb-3" style="color: var(--text-primary); line-height: var(--line-height-relaxed); padding-left: var(--space-2);">
                        {{ step }}
                    </li>
                    {% endfor %}
                </ol>
            </div>
            {% endif %}

            <!-- 8. Калорийность и макросы -->
            {% if recipe_data.calculated_nutrition %}
            <div class="mb-6" style="padding-top: var(--space-6);">
                <div class="body-large" style="color: var(--text-primary);">
                    <div class="mb-2">
                        <strong>Калории:</strong> {{ recipe_data.calculated_nutrition.calories|int }} ккал
                    </div>
                    <div class="mb-2">
                        <strong>Белки:</strong> {{ recipe_data.calculated_nutrition.protein_g|int }}г
                    </div>
                    <div class="mb-2">
                        <strong>Жиры:</strong> {{ recipe_data.calculated_nutrition.fat_g|int }}г
                    </div>
                    <div>
                        <strong>Углеводы:</strong> {{ recipe_data.calculated_nutrition.carbs_g|int }}г
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 9. Финальный смысловой блок (опционально) -->
            {% if recipe_data.get('final_note') %}
            <div class="mb-6" style="padding-top: var(--space-8);">
                <p class="body-large" style="color: var(--text-primary); line-height: var(--line-height-relaxed);">
                    {{ recipe_data.final_note }}
                </p>
            </div>
            {% endif %}

            <!-- 10. Нижние действия (CTA) -->
            <div class="mt-6 pt-6" style="border-top: 1px solid var(--border-light);">
                <div class="d-flex flex-column flex-sm-row gap-3" style="align-items: flex-start;">
                    <a href="/recipes/create" class="btn btn-primary" style="min-width: 200px;">
                        Приготовить ещё
                    </a>
                    <a href="/recipes" class="text-secondary text-decoration-none body-medium transition-fast" style="display: inline-flex; align-items: center; padding: var(--space-2) 0;">
                        Назад к рецептам
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Стили для hover эффекта на кнопке "Назад" */
.back-link:hover {
    color: var(--text-primary) !important;
    opacity: 0.8;
}

/* Стили для списка ингредиентов */
.ingredients-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

/* Стили для нумерованного списка шагов */
.cooking-steps {
    list-style: decimal;
    list-style-position: outside;
    padding-left: var(--space-6);
}

.cooking-steps li {
    margin-bottom: var(--space-3);
    padding-left: var(--space-2);
}

.cooking-steps li::marker {
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
}

/* Улучшаем отступы между секциями */
.mb-6 {
    margin-bottom: var(--space-8) !important;
}

.mt-6 {
    margin-top: var(--space-8) !important;
}

.pt-6 {
    padding-top: var(--space-8) !important;
}
</style>
{% endblock %}
